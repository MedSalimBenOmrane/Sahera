<main class="table" id="customers_table">
 <section class="table__header">
  <h1>Liste des participants</h1>

  <!-- Filtres -->
  <div class="filters">
    <input
      type="number"
      min="1"
      class="input-filter"
      placeholder="ID exact"
      [(ngModel)]="searchId"
      (input)="onSearchChanged()"
    />
    <input
      type="text"
      class="input-filter"
      placeholder="Nom (commence par...)"
      [(ngModel)]="searchNom"
      (input)="onSearchChanged()"
    />
    <input
      type="text"
      class="input-filter"
      placeholder="Prénom (commence par...)"
      [(ngModel)]="searchPrenom"
      (input)="onSearchChanged()"
    />
  </div>

  <div class="col-2">
    <button class="cssbuttons-io-button" (click)="openCreateDialog()">
      <svg height="24" width="24" viewBox="0 0 24 24">
        <path d="M0 0h24v24H0z" fill="none"></path>
        <path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z" fill="currentColor"></path>
      </svg>
      <span>Créer</span>
    </button>
  </div>
</section>

  <div class="list-wrap">
  <section class="table__body">
    <table>
      <thead>
        <tr>
          <!-- Vos colonnes existantes… -->
          <th (click)="sortTable('id', true)">ID <span class="icon-arrow">&UpArrow;</span></th>
          <th (click)="sortTable('nom', true)">Nom <span class="icon-arrow">&UpArrow;</span></th>
          <th (click)="sortTable('prenom', true)">Prénom <span class="icon-arrow">&UpArrow;</span></th>
          <th (click)="sortTable('email', true)">Email <span class="icon-arrow">&UpArrow;</span></th>
          <th (click)="sortTable('telephone', true)">Téléphone <span class="icon-arrow">&UpArrow;</span></th>
          <th (click)="sortTable('date_naissance', true)">Date de naissance <span class="icon-arrow">&UpArrow;</span></th>
          <th (click)="sortTable('genre', true)">Genre <span class="icon-arrow">&UpArrow;</span></th>
          <th (click)="sortTable('ethnicite', true)">Ethnicité <span class="icon-arrow">&UpArrow;</span></th>
          <th (click)="sortTable('role', true)">Rôle <span class="icon-arrow">&UpArrow;</span></th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
  <ng-container *ngIf="isLoading; else dataRows">
    <tr>
      <td colspan="10" class="p-0">
        <div class="d-flex justify-content-center align-items-center" style="height: 200px;">
          <div class="spinner-border" role="status">
            <span class="visually-hidden">Chargement…</span>
          </div>
        </div>
      </td>
    </tr>
  </ng-container>

  <ng-template #dataRows>
    <tr *ngIf="displayedClients.length === 0">
      <td colspan="10" class="p-0">
        <div class="d-flex flex-column justify-content-center align-items-center" style="height: 200px;">
          <img src="assets/images/empty-folder.png" alt="Aucun participant" style="max-width: 150px;" class="mb-2" />
          <p class="mb-0">
            {{ hasAnyFilter ? 'Aucun participant trouvé pour ces critères.' : 'Aucun participant pour le moment.' }}
          </p>
        </div>
      </td>
    </tr>

    <tr *ngFor="let c of displayedClients">
      <td>{{c.id}}</td>
      <td>{{c.nom}}</td>
      <td>{{c.prenom}}</td>
      <td>{{c.email}}</td>
      <td>{{c.telephone}}</td>
      <td>{{c.date_naissance | date:'dd/MM/yyyy'}}</td>
      <td>{{c.genre}}</td>
      <td>{{c.ethnicite}}</td>
      <td>{{c.role}}</td>
      <td class="actions-cell">
        <button class="btn-modifier" (click)="openEditDialog(c)">Modifier</button>
        <button class="btn-supprimer" (click)="confirmDelete(c)">Supprimer</button>
      </td>
    </tr>
  </ng-template>
</tbody>
    </table>
  </section>
  </div>
  <!-- ✅ Pagination en bas du container -->
  <nav *ngIf="!hasAnyFilter && totalPages > 1"
       class="pagination-wrap d-flex justify-content-center mt-4"
       aria-label="Pagination des participants">
    <ul class="pagination">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <button class="page-link bg-transparent" (click)="firstPage()" [disabled]="currentPage === 1">«</button>
      </li>
      <li class="page-item" [class.disabled]="currentPage === 1">
        <button class="page-link bg-transparent" (click)="prevPage()" [disabled]="currentPage === 1">Précédent</button>
      </li>

      <li class="page-item" *ngFor="let p of pageNumbers" [class.active]="p === currentPage">
        <button class="page-link bg-transparent" (click)="goToPage(p)">{{ p }}</button>
      </li>

      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <button class="page-link bg-transparent" (click)="nextPage()" [disabled]="currentPage === totalPages">Suivant</button>
      </li>
      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <button class="page-link bg-transparent" (click)="lastPage()" [disabled]="currentPage === totalPages">»</button>
      </li>
    </ul>
  </nav>

  <!-- dialog … -->
</main>
  <!-- Le même dialog pour Create / Edit -->
  <dialog #dialog>
    <!-- Titre dynamique -->
    <h2>{{ isEditMode ? 'modifier participant' : 'Crée nouveau participant' }}</h2>

    <!-- Formulaire “template-driven” -->
    <div class="row" *ngFor="let field of formFields">
      <div class="col-5">{{ field.label }} :</div>
      <div class="col-7">
       
        <input
          *ngIf="field.type!=='select'"
          [type]="field.type"
          class="input5"
          [placeholder]="field.label"
          [(ngModel)]="form[field.key]"
          name="{{field.key}}"
        />
        <select
          *ngIf="field.type==='select'"
          class="input5"
          [(ngModel)]="form[field.key]"
          name="{{field.key}}"
        >
          <option value="" disabled selected>{{field.label}}</option>
          <option *ngFor="let opt of field.options" [value]="opt">{{opt}}</option>
        </select>
      </div>
    </div>

    <div class="row">
      <button class="boton-elegante" (click)="saveClient()">
        {{ isEditMode ? 'enregistrer les Changements' : 'Créer Participant' }}
      </button>
    </div>
    <button class="x" aria-label="close" (click)="closeDialog()">❌</button>
  </dialog>

