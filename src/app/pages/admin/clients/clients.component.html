<main class="table" id="customers_table">
 <section class="table__header">
  <h1>
    {{ 'admin.participants.title' | translate }}
    ({{ 'admin.participants.total' | translate }} : {{ totalParticipants }})
  </h1>

  <div class="filters">
    <input
      type="number"
      min="1"
      class="input-filter"
      [placeholder]="'admin.filters.id' | translate"
      [(ngModel)]="searchId"
      (input)="onSearchChanged()"
    />
    <input
      type="text"
      class="input-filter"
      [placeholder]="'admin.filters.name' | translate"
      [(ngModel)]="searchNom"
      (input)="onSearchChanged()"
    />
    <input
      type="text"
      class="input-filter"
      [placeholder]="'admin.filters.firstname' | translate"
      [(ngModel)]="searchPrenom"
      (input)="onSearchChanged()"
    />
  </div>

  <div class="col-2">
    <button class="cssbuttons-io-button" (click)="openCreateDialog()">
      <svg height="24" width="24" viewBox="0 0 24 24">
        <path d="M0 0h24v24H0z" fill="none"></path>
        <path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z" fill="currentColor"></path>
      </svg>
      <span>{{ 'admin.create' | translate }}</span>
    </button>
  </div>
</section>

  <div class="list-wrap">
  <section class="table__body">
    <table>
      <thead>
        <tr>
          <th (click)="sortTable('id', true)">{{ 'admin.table.id' | translate }} <span class="icon-arrow">&UpArrow;</span></th>
          <th (click)="sortTable('nom', true)">{{ 'admin.table.name' | translate }} <span class="icon-arrow">&UpArrow;</span></th>
          <th (click)="sortTable('prenom', true)">{{ 'admin.table.firstname' | translate }} <span class="icon-arrow">&UpArrow;</span></th>
          <th (click)="sortTable('email', true)">{{ 'admin.table.email' | translate }} <span class="icon-arrow">&UpArrow;</span></th>
          <th (click)="sortTable('telephone', true)">{{ 'admin.table.phone' | translate }} <span class="icon-arrow">&UpArrow;</span></th>
          <th (click)="sortTable('date_naissance', true)">{{ 'admin.table.birthdate' | translate }} <span class="icon-arrow">&UpArrow;</span></th>
          <th (click)="sortTable('genre', true)">{{ 'admin.table.gender' | translate }} <span class="icon-arrow">&UpArrow;</span></th>
          <th (click)="sortTable('ethnicite', true)">{{ 'admin.table.ethnicity' | translate }} <span class="icon-arrow">&UpArrow;</span></th>
          <th (click)="sortTable('role', true)">{{ 'admin.table.role' | translate }} <span class="icon-arrow">&UpArrow;</span></th>
          <th>{{ 'admin.actions' | translate }}</th>
        </tr>
      </thead>
      <tbody>
  <ng-container *ngIf="isLoading; else dataRows">
    <tr>
      <td colspan="10" class="p-0">
        <div class="d-flex justify-content-center align-items-center" style="height: 200px;">
          <div class="spinner-border" role="status">
            <span class="visually-hidden">{{ 'generic.loading' | translate }}</span>
          </div>
        </div>
      </td>
    </tr>
  </ng-container>

  <ng-template #dataRows>
    <tr *ngIf="displayedClients.length === 0">
      <td colspan="10" class="p-0">
        <div class="d-flex flex-column justify-content-center align-items-center" style="height: 200px;">
          <img src="assets/images/empty-folder.png" [attr.alt]="(hasAnyFilter ? 'admin.emptyFiltered' : 'admin.empty') | translate" style="max-width: 150px;" class="mb-2" />
          <p class="mb-0">
            {{ hasAnyFilter ? ('admin.emptyFiltered' | translate) : ('admin.empty' | translate) }}
          </p>
        </div>
      </td>
    </tr>

    <tr *ngFor="let c of displayedClients">
      <td [attr.data-label]="'admin.table.id' | translate">{{c.id}}</td>
      <td [attr.data-label]="'admin.table.name' | translate">{{c.nom}}</td>
      <td [attr.data-label]="'admin.table.firstname' | translate">{{c.prenom}}</td>
      <td [attr.data-label]="'admin.table.email' | translate">{{c.email}}</td>
      <td [attr.data-label]="'admin.table.phone' | translate">{{c.telephone}}</td>
      <td [attr.data-label]="'admin.table.birthdate' | translate">{{c.date_naissance | date:'dd/MM/yyyy'}}</td>
      <td [attr.data-label]="'admin.table.gender' | translate">{{ i18n.translateOptionLabel('gender', c.genre) }}</td>
      <td [attr.data-label]="'admin.table.ethnicity' | translate">{{ i18n.translateOptionLabel('ethnicity', c.ethnicite) }}</td>
      <td [attr.data-label]="'admin.table.role' | translate">{{c.role}}</td>
      <td class="actions-cell" [attr.data-label]="'admin.actions' | translate">
        <button class="btn-modifier" (click)="openEditDialog(c)">{{ 'admin.edit' | translate }}</button>
        <button class="btn-supprimer" (click)="confirmDelete(c)">{{ 'admin.delete' | translate }}</button>
      </td>
    </tr>
  </ng-template>
</tbody>
    </table>
  </section>
  </div>
  <nav *ngIf="!hasAnyFilter && totalPages > 1"
       class="pagination-wrap d-flex justify-content-center mt-4"
       aria-label="Pagination des participants">
    <ul class="pagination">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <button class="page-link" (click)="firstPage()" [disabled]="currentPage === 1">&laquo;</button>
      </li>
      <li class="page-item" [class.disabled]="currentPage === 1">
        <button class="page-link" (click)="prevPage()" [disabled]="currentPage === 1">{{ 'pagination.prev' | translate }}</button>
      </li>

      <li class="page-item" *ngFor="let p of pageNumbers" [class.active]="p === currentPage">
        <button class="page-link" (click)="goToPage(p)">{{ p }}</button>
      </li>

      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <button class="page-link" (click)="nextPage()" [disabled]="currentPage === totalPages">{{ 'pagination.next' | translate }}</button>
      </li>
      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <button class="page-link" (click)="lastPage()" [disabled]="currentPage === totalPages">&raquo;</button>
      </li>
    </ul>
  </nav>

</main>
  <dialog #dialog>
    <h2>{{ isEditMode ? ('admin.dialog.editTitle' | translate) : ('admin.dialog.createTitle' | translate) }}</h2>

    <div class="row" *ngFor="let field of formFields">
      <div class="col-5">{{ field.labelKey | translate }} :</div>
      <div class="col-7">
       
        <input
          *ngIf="field.type!=='select'"
          [type]="field.type"
          class="input5"
          [placeholder]="field.labelKey | translate"
          [(ngModel)]="form[field.key]"
          name="{{field.key}}"
        />
        <select
          *ngIf="field.type==='select'"
          class="input5"
          [(ngModel)]="form[field.key]"
          name="{{field.key}}"
        >
          <option value="" disabled selected>{{field.labelKey | translate}}</option>
          <option *ngFor="let opt of field.options" [value]="opt.value">{{opt.labelKey | translate}}</option>
        </select>
      </div>
    </div>

    <div class="row">
      <button class="boton-elegante" (click)="saveClient()">
        {{ isEditMode ? ('admin.saveChanges' | translate) : ('admin.createParticipant' | translate) }}
      </button>
    </div>
    <button class="x" aria-label="close" (click)="closeDialog()">Ã—</button>
  </dialog>


