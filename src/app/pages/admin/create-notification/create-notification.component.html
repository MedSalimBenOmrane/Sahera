<div class="container my-4">
  <div class="glass-container p-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
      <h1>{{ 'admin.notifications.title' | translate }}</h1>
      <button class="btn btn-primary" (click)="openCreateDialog()">{{ 'admin.notifications.send' | translate }}</button>
    </div>

    <dialog #dialog>
      <h2>{{ 'admin.notifications.dialogTitle' | translate }}</h2>
      <div class="mb-3">
        <label>{{ 'admin.notifications.subject' | translate }}</label>
        <input type="text" class="form-control" [(ngModel)]="newNotif.titre" [placeholder]="'admin.notifications.placeholderTitle' | translate" />
      </div>
      <div class="mb-3">
        <label>{{ 'admin.notifications.message' | translate }}</label>
        <textarea class="form-control" rows="5" [(ngModel)]="newNotif.contenu" [placeholder]="'admin.notifications.placeholderMessage' | translate"></textarea>
      </div>
      <button class="btn btn-success" (click)="sendNotification()">{{ 'admin.notifications.sendAction' | translate }}</button>
      <button class="btn btn-secondary ms-2" (click)="closeDialog()">{{ 'admin.notifications.cancel' | translate }}</button>
    </dialog>

    <hr />

    <div class="list-wrap">

      <div *ngIf="isLoading" class="d-flex justify-content-center align-items-center" style="min-height: 60vh;">
        <div class="spinner-border" role="status"><span class="visually-hidden">{{ 'notifications.loading' | translate }}</span></div>
      </div>

      <ng-container *ngIf="!isLoading">
        <ng-container *ngIf="notifications && notifications.length > 0; else emptyState">
          <app-notification
            *ngFor="let notif of notifications; let i = index"
            [notification]="notif"
            [index]="i"
            [isAdminView]="true"
            (deleteNotification)="onDeleteNotification($event)">
          </app-notification>
        </ng-container>
      </ng-container>

      <ng-template #emptyState>
        <div class="d-flex flex-column justify-content-center align-items-center" style="min-height:60vh;">
          <p class="mb-3 fs-5">{{ 'notifications.emptyLead' | translate }}</p>
          <h2 class="mb-3">{{ 'notifications.emptyTitle' | translate }}</h2>
          <img src="assets/images/empty-folder.png" [attr.alt]="'notifications.emptyTitle' | translate" class="img-fluid" style="max-width:200px;">
        </div>
      </ng-template>
    </div>

    <nav *ngIf="notifications?.length && totalPages > 1"
         class="pagination-wrap d-flex justify-content-center mt-4"
         aria-label="Pagination des notifications">
      <ul class="pagination">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <button class="page-link" (click)="firstPage()" [disabled]="currentPage === 1">&laquo;</button>
        </li>
        <li class="page-item" [class.disabled]="currentPage === 1">
          <button class="page-link" (click)="prevPage()" [disabled]="currentPage === 1">{{ 'pagination.prev' | translate }}</button>
        </li>

        <li class="page-item" *ngFor="let p of pageNumbers" [class.active]="p === currentPage">
          <button class="page-link" (click)="goToPage(p)">{{ p }}</button>
        </li>

        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <button class="page-link" (click)="nextPage()" [disabled]="currentPage === totalPages">{{ 'pagination.next' | translate }}</button>
        </li>
        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <button class="page-link" (click)="lastPage()" [disabled]="currentPage === totalPages">&raquo;</button>
        </li>
      </ul>
    </nav>

  </div>
</div>

