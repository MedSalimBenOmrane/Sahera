<head>
  <title>Slide Navbar</title>
  <link href="https://fonts.googleapis.com/css2?family=Jost:wght@500&display=swap" rel="stylesheet">
</head>

<body>
  <div class="login-wrapper">
    <!-- image √† gauche (desktop only) -->
<div class="side-slideshow" aria-label="Diaporama d√©cor">
  
    <div class="slide-layer"
     [ngStyle]="{'--cap-pad':'10%'}"
    *ngFor="let src of slides; let i = index"
    [class.is-active]="i === currentSlide"
    [ngStyle]="{
      'background-image': 'url(' + src + ')',
      '-webkit-mask-image': 'url(' + src + ')',
      'mask-image': 'url(' + src + ')'
    }"
  >
    <div class="slide-caption" *ngIf="captions?.length">
      {{ captions[i] }}
    </div>
  </div>

</div>
  <div class="main">
    <!-- Checkbox invisible qui g√®re le toggle Inscription/Connexion -->
    <input type="checkbox" id="chk" aria-hidden="false" />

    <!-- ===== Partie Inscription (Signup) ===== -->
    <div class="signup">
      <!-- On lie le formGroup ‚ÄúsignupForm‚Äù ici -->
      <form [formGroup]="signupForm" (ngSubmit)="onSignup()">
        <label class="titleInscription" for="chk" aria-hidden="false">Inscription</label>

        <input class="input"
          id="nom"
          type="text"
          formControlName="nom"
          placeholder="Nom"
          (blur)="onBlurField('nom')"
          [class.error-border]="isFieldInvalid('nom')"
        />

        <input class="input"
          id="prenom"
          type="text"
          formControlName="prenom"
          placeholder="Pr√©nom"
          (blur)="onBlurField('prenom')"
          [class.error-border]="isFieldInvalid('prenom')"
        />

        <input class="input"
          id="emailSignup"
          type="email"
          formControlName="email"
          placeholder="Email"
          (blur)="onBlurField('email')"
          [class.error-border]="isFieldInvalid('email')"
        />

        <input class="input"
          id="passwordSignup"
          type="password"
          formControlName="password"
          placeholder="Password"
          (blur)="onBlurField('password')"
          [class.error-border]="isFieldInvalid('password')"
        />

        <input class="input"
          id="telephone"
          type="text"
          formControlName="telephone"
          placeholder="T√©l√©phone"
          (blur)="onBlurField('telephone')"
          [class.error-border]="isFieldInvalid('telephone')"
        />

  <input
  id="dateNaissance"
  class="input"
  [attr.type]="dateInputType"         
  formControlName="dateNaissance"
  placeholder="Date de naissance"     
  (focus)="dateInputType='date'"
  (click)="dateInputType='date'"       
  (blur)="onDateBlur()"
  [class.error-border]="isFieldInvalid('dateNaissance')"
  [max]="maxDate"                    
/>

        <div class="genre-container" role="group" aria-labelledby="genre-label">
  <span id="genre-label" class="genre-label">Sexe :</span>

  <label class="genre-radio" [class.error-border]="isFieldInvalid('genre')">
    <input
      class="input"
      type="radio"
      formControlName="genre"
      [value]="'Femme'"
      (change)="onBlurField('genre')"
    />
    Femme
  </label>

  <label class="genre-radio" [class.error-border]="isFieldInvalid('genre')">
    <input
      class="input"
      type="radio"
      formControlName="genre"
      [value]="'Homme'"
      (change)="onBlurField('genre')"
    />
    Homme
  </label>
</div>

<select
  id="ethnicite"
  class="input"
  formControlName="ethnicite"
  (blur)="onBlurField('ethnicite')"
  [class.error-border]="isFieldInvalid('ethnicite')"
  required
>
  <option [ngValue]="null" disabled>Ethnicit√©</option>
  <option *ngFor="let opt of ethniciteOptions" [ngValue]="opt">{{ opt }}</option>
</select>


        <button type="submit">S'inscrire</button>
      </form>
    </div>

    <!-- ===== Partie Connexion (Login) ===== -->
    <div class="login">
      <!-- On lie le formGroup ‚ÄúloginForm‚Äù ici -->
      <form [formGroup]="loginForm" (ngSubmit)="onLogin()">
        <label class="titleConnexion" for="chk" aria-hidden="false">Connexion</label>

        <input class="input"
          id="emailLogin"
          type="email"
          formControlName="email"
          placeholder="Email"
          (blur)="onBlurLoginField('email')"
          [class.error-border]="isLoginFieldInvalid('email')"
        />

        <input class="input"
                  id="passwordLogin"
          type="password"
          formControlName="password"
          placeholder="Password"
          (blur)="onBlurLoginField('password')"
          [class.error-border]="isLoginFieldInvalid('password')"
        />
        <div class="form-check">
  <input
    class="form-check-input "
    type="checkbox"            
    id="isAdmin"
    formControlName="isAdmin"
  />
  <label class="form-check-label" for="isAdmin">
    Se connecter en tant qu‚Äôadmin
  </label>
</div>




        <button type="submit">Se connecter</button>
        <div class="pwd" (click)="openForgotDialog()">Mot de passe oubli√© ?</div>
        <div class="navbar-brand "><img src="assets/images/logo.png" alt="Brand Logo"></div>
      </form>
    </div>
  </div>
     
  </div>
</body>
<dialog #dialog>
  <h1 class="title">Consentement √©clair√© et v√©rification</h1>

  <!-- Consentement: scroll obligatoire pour activer la case -->
  <div class="consent-box">
    <div class="consent-scroll" (scroll)="onConsentScroll($event)">
      <h2>Consentement √©clair√© et engagement de participation</h2>
      <h2>Titre du projet</h2>
      <p>√âtude sur l‚Äôexp√©rience d‚Äôutilisation d‚Äôun dispositif d‚Äôacupression auriculaire pour le soulagement des sympt√¥mes g√©n√©raux de la p√©rim√©nopause, des troubles du cycle menstruel et du stress</p>
      <h2>Objectif du projet</h2>
      <p><span class="consent-strong">Ce projet vise √† comprendre</span> comment ce dispositif favorise le mieux-√™tre de ses utilisatrices. Plus pr√©cis√©ment, il cherche √† √©valuer le <span class="consent-strong">confort d‚Äôutilisation</span>, la <span class="consent-strong">facilit√© d‚Äôint√©gration</span> √† la routine quotidienne et les effets ressentis sur des sympt√¥mes tels que les douleurs cycliques, les tensions musculaires, les troubles du sommeil, ou les variations d‚Äôhumeur associ√©es au stress ou aux changements hormonaux.</p>
      <h2>Renseignements recueillis</h2>
      <p>Nous collectons vos coordonn√©es de base (nom, pr√©nom, √¢ge, genre, origine ethnique et courriel) afin d‚Äôassurer le suivi de votre participation, de vous transmettre les questionnaires d‚Äô√©valuation et de recueillir vos commentaires sur le dispositif. Ces informations soutiennent la validation scientifique du dispositif et la production des analyses globales men√©es aupr√®s de la cohorte participante.</p>
      <p>Les questionnaires portent sur votre exp√©rience d‚Äôutilisation‚ÄØ: confort du dispositif, fr√©quence d‚Äôusage, contexte, effets per√ßus sur les douleurs, le sommeil, le stress et le bien-√™tre g√©n√©ral, ainsi que votre satisfaction globale.</p>
      <p><span class="consent-strong">S√©curit√© et confidentialit√© :</span> Toutes les donn√©es sont conserv√©es sur des serveurs s√©curis√©s, conform√©ment √† la Loi‚ÄØ25 sur la protection des renseignements personnels au Qu√©bec. Lors de l‚Äôanalyse, l‚Äôensemble des donn√©es sera anonymis√© pour garantir la confidentialit√© des participantes.</p>
      <h2>Engagement et relation de partenariat</h2>
      <p>En recevant ce dispositif gratuitement, vous devenez partenaire actif du projet. Votre participation contribue directement √† la validation scientifique et √† l‚Äôam√©lioration du dispositif. Nous souhaitons √©galement vous tenir inform√©e des rapports d‚Äôanalyse et de validation scientifique issus de cette √©tude, afin que vous puissiez suivre les r√©sultats collectifs de la cohorte et les avanc√©es du projet. √Ä ce titre, vous consentez √©galement √† recevoir notre newsletter, qui vous transmettra p√©riodiquement des nouvelles du projet, les r√©sultats d‚Äô√©tape et des informations compl√©mentaires sur les activit√©s de recherche et de d√©veloppement. Si vous d√©cidez d‚Äôinterrompre votre participation, vous vous engagez √† retourner le dispositif, afin de permettre le respect du protocole d‚Äô√©tude.</p>
      <h2>Dur√©e, moments d‚Äô√©valuation et retrait</h2>
      <p>Votre participation dure environ <span class="consent-strong">une ann√©e</span>, √† compter de la date o√π vous avez re√ßu le dispositif. Afin de suivre l‚Äô√©volution de votre exp√©rience dans le temps, deux √©valuations vous seront demand√©es :</p>
      <ul class="consent-list">
        <li>Une premi√®re apr√®s <span class="consent-strong">6 mois</span> d‚Äôutilisation continue.</li>
        <li>Une seconde apr√®s <span class="consent-strong">12 mois</span>, au terme de votre participation.</li>
      </ul>
      <p>Chaque √©valuation consiste √† remplir le m√™me formulaire de suivi (questionnaire sur le confort, les effets ressentis et la satisfaction). Ces deux temps de r√©ponse permettront d‚Äô√©valuer l‚Äô√©volution des effets per√ßus au fil du temps et de renforcer la valeur scientifique des r√©sultats du projet.</p>
      <p class="consent-mail">üìß Pour toute question ou pour retirer votre consentement, √©crivez-nous √† :
        <a href="mailto:info@sahera.ca" rel="noopener">info@sahera.ca</a>.
        En cas de retrait, vous devrez restituer le dispositif fourni.
      </p>
      <h2>Consentement</h2>
      <p class="consent-note">En cochant la case ci-dessous, vous confirmez avoir lu et compris les informations ci-dessus, et consentez √† participer √† cette √©tude selon les conditions pr√©cis√©es.</p>
    </div>
    <label class="consent-check">
      <input type="checkbox" [disabled]="!consentScrolled" [checked]="consentChecked" (change)="onConsentChanged($any($event.target).checked)" />
      Oui, je consens √† participer √† l‚Äô√©tude, j‚Äôaccepte les conditions de participation et de retour du dispositif, et j‚Äôaccepte de recevoir la newsletter d‚Äôinformation relative √† cette √©tude.
    </label>
  </div>

  <!-- Zone OTP: activ√©e uniquement apr√®s envoi du code (regToken pr√©sent) -->
  <h2 class="subtitle">Entrez le code envoy√© √† votre email</h2>
  <form id="otp-form" (paste)="onOtpPaste($event)" (submit)="$event.preventDefault()">
    <input #otpInput type="text" class="otp-input" maxlength="1" [disabled]="!regToken"
           [value]="otpDigits[0]" (input)="onOtpInput(0,$event)" (keydown)="onOtpKeydown(0,$event)">
    <input #otpInput type="text" class="otp-input" maxlength="1" [disabled]="!regToken"
           [value]="otpDigits[1]" (input)="onOtpInput(1,$event)" (keydown)="onOtpKeydown(1,$event)">
    <input #otpInput type="text" class="otp-input" maxlength="1" [disabled]="!regToken"
           [value]="otpDigits[2]" (input)="onOtpInput(2,$event)" (keydown)="onOtpKeydown(2,$event)">
    <input #otpInput type="text" class="otp-input" maxlength="1" [disabled]="!regToken"
           [value]="otpDigits[3]" (input)="onOtpInput(3,$event)" (keydown)="onOtpKeydown(3,$event)">
    <input #otpInput type="text" class="otp-input" maxlength="1" [disabled]="!regToken"
           [value]="otpDigits[4]" (input)="onOtpInput(4,$event)" (keydown)="onOtpKeydown(4,$event)">
  </form>

  <div class="row">
    <div class="col-6">
      <button id="verify-btn" (click)="verifyOtp()" [disabled]="!regToken || verifying || otpDigits.join('').length!==5">V√©rifier</button>
    </div>
    <div class="col-6">
      <button id="resend-btn" (click)="resendCode()" [disabled]="!regToken || resendCooldown>0">
        Renvoyer code<span *ngIf="resendCooldown>0"> ({{resendCooldown}}s)</span>
      </button>
    </div>
  </div>

  <button id="x" aria-label="close" (click)="closeDialog()">‚ùå</button>
</dialog>


<dialog #forgotDialog>
  <h1 class="title">R√©initialiser le mot de passe</h1>

  <!-- Message d‚Äôerreur rouge au-dessus de l‚ÄôOTP / champs -->
  <div *ngIf="fpError" style="color:#b91c1c; margin-bottom:10px; font-weight:600;">
    {{ fpError }}
  </div>

  <!-- 1) Email requis -->
  <div style="margin-bottom: 12px;">
    <input
      type="email"
      class="input"
      placeholder="Email"
      [(ngModel)]="fpEmail"
      name="fpEmail"
      required
      
    />
    <button id="send-reset-code-btn"
            (click)="sendResetCode()"
            [disabled]="fpResetToken">Envoyer le code</button>
  </div>

  <!-- 2) OTP (affich√© si on a un reset_token) -->
  <form *ngIf="fpResetToken" (paste)="onFpOtpPaste($event)" (submit)="$event.preventDefault()"
        style="margin-top: 10px;">
    <div id="otp-form">
      <input type="text" class="otp-input fp-otp-input" maxlength="1"
             [value]="fpOtpDigits[0]" (input)="onFpOtpInput(0,$event)" (keydown)="onFpOtpKeydown(0,$event)">
      <input type="text" class="otp-input fp-otp-input" maxlength="1"
             [value]="fpOtpDigits[1]" (input)="onFpOtpInput(1,$event)" (keydown)="onFpOtpKeydown(1,$event)">
      <input type="text" class="otp-input fp-otp-input" maxlength="1"
             [value]="fpOtpDigits[2]" (input)="onFpOtpInput(2,$event)" (keydown)="onFpOtpKeydown(2,$event)">
      <input type="text" class="otp-input fp-otp-input" maxlength="1"
             [value]="fpOtpDigits[3]" (input)="onFpOtpInput(3,$event)" (keydown)="onFpOtpKeydown(3,$event)">
      <input type="text" class="otp-input fp-otp-input" maxlength="1"
             [value]="fpOtpDigits[4]" (input)="onFpOtpInput(4,$event)" (keydown)="onFpOtpKeydown(4,$event)">
    </div>

    <div class="row" style="margin-top: 14px;">
      <div class="col-6">
        <button id="verify-reset-btn" (click)="verifyResetOtp()" [disabled]="fpVerifying">V√©rifier</button>
      </div>
      <div class="col-6">
        <button id="resend-reset-btn" (click)="resendResetCode()" [disabled]="fpResendCooldown>0">
          Renvoyer code<span *ngIf="fpResendCooldown>0"> ({{fpResendCooldown}}s)</span>
        </button>
      </div>
    </div>
  </form>

  <!-- 3) Nouveau mot de passe (activ√© uniquement si OTP v√©rifi√© c√¥t√© back) -->
  <div style="margin-top: 18px;">
    <input type="password" class="input" placeholder="Nouveau mot de passe"
           [(ngModel)]="newPw" name="newPw"
           [disabled]="!fpVerified">
    <input type="password" class="input" placeholder="Confirmer le mot de passe"
           [(ngModel)]="newPw2" name="newPw2"
           [disabled]="!fpVerified">
    <button (click)="saveNewPassword()" [disabled]="!fpVerified">Enregistrer</button>
  </div>

  <button id="x" aria-label="close" (click)="closeForgotDialog()">‚ùå</button>
</dialog>
